<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>极简AI聊天测试</title>
    <style>
        /* 极简样式，保证功能可用 */
        body { padding: 20px; font-family: Arial; }
        #chat-container { width: 500px; height: 400px; border: 1px solid #ccc; padding: 10px; overflow-y: auto; margin-bottom: 10px; }
        .user-msg { text-align: right; margin: 5px 0; color: blue; }
        .ai-msg { text-align: left; margin: 5px 0; color: green; }
        #msg-input { width: 400px; height: 60px; padding: 5px; }
        #send-btn { width: 80px; height: 60px; }
        .error { color: red; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>AI聊天测试（对接火山方舟豆包）</h1>
    <div id="chat-container"></div>
    <textarea id="msg-input" placeholder="输入消息发送（比如：你好）"></textarea>
    <button id="send-btn">发送</button>
    <div class="error" id="error-box"></div>

    <script>
        // 已替换成我部署好的后端地址（无需修改）
        const API_URL = 'https://ai-chat-huoshan.vercel.app/api/chat';
        
        const chatContainer = document.getElementById('chat-container');
        const msgInput = document.getElementById('msg-input');
        const sendBtn = document.getElementById('send-btn');
        const errorBox = document.getElementById('error-box');

        // 发送消息函数
        function sendMsg() {
            const msg = msgInput.value.trim();
            if (!msg) return;
            
            // 显示用户消息
            const userMsg = document.createElement('div');
            userMsg.className = 'user-msg';
            userMsg.textContent = `我：${msg}`;
            chatContainer.appendChild(userMsg);
            
            // 清空输入框
            msgInput.value = '';
            errorBox.textContent = '';

            // 显示加载中
            const loadingMsg = document.createElement('div');
            loadingMsg.className = 'ai-msg';
            loadingMsg.textContent = 'AI：思考中...';
            chatContainer.appendChild(loadingMsg);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // 调用后端API（已对接火山方舟豆包）
            fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: msg })
            })
            .then(res => res.json())
            .then(data => {
                // 删除加载中提示
                chatContainer.removeChild(loadingMsg);
                
                // 显示AI回复
                const aiMsg = document.createElement('div');
                aiMsg.className = 'ai-msg';
                aiMsg.textContent = `AI：${data.reply || '暂无回复'}`;
                chatContainer.appendChild(aiMsg);
                // 滚动到底部
                chatContainer.scrollTop = chatContainer.scrollHeight;
            })
            .catch(err => {
                // 删除加载中提示
                chatContainer.removeChild(loadingMsg);
                
                errorBox.textContent = `请求失败：${err.message}，请检查网络`;
                console.error('错误：', err);
            });
        }

        // 绑定事件
        sendBtn.addEventListener('click', sendMsg);
        msgInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMsg();
            }
        });
    </script>
</body>
</html>
